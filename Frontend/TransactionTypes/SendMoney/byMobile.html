<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>UPI Payment Interface</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/react/18.2.0/umd/react.production.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/react-dom/18.2.0/umd/react-dom.production.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/babel-standalone/7.21.2/babel.min.js"></script>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        .Body {
            font-family: 'Poppins', sans-serif;
            background: linear-gradient(to bottom right, #121212, #292929);
            color: white;
            display: flex;
            justify-content: center;
            align-items: center;
            min-height: 100vh;
            margin: 0;
        }

        .container {
            width: 60%;
            max-width:600px !important;
            background: #1e1e1e;
            padding: 25px;
            border-radius: 12px;
            box-shadow: 0 4px 10px rgba(0, 0, 0, 0.3);
        }

        .header {
            font-size: 22px;
            font-weight: 600;
            text-align: center;
            margin-bottom: 15px;
        }

        .input-box {
            width: 100%;
            padding: 12px;
            border: 2px solid #444;
            border-radius: 8px;
            background: #2b2b2b;
            color: white;
            font-size: 16px;
            margin-top: 10px;
        }

        .btn {
            width: 100%;
            padding: 12px;
            border: none;
            border-radius: 8px;
            font-size: 16px;
            font-weight: 600;
            background: #4f46e5;
            color: white;
            cursor: pointer;
            transition: all 0.3s ease;
            margin-top: 15px;
        }

        .btn:hover {
            background: #3b3bb3;
        }

        .profile-card {
            text-align: center;
            padding: 20px;
            background: #2b2b2b;
            border-radius: 10px;
            margin-bottom: 20px;
        }

        .profile-img {
            width: 100px;
            height: 100px;
            border-radius: 50%;
            object-fit: cover;
            margin-bottom: 10px;
        }
        .ToUserContainer{
            display:flex;
            margin:10px;
            margin-top:20px;
            margin-bottom:20px;
            cursor: pointer;
        }
        .page-container {
            display: flex;
            justify-content: center;
           
            width: 100%;
            background-color: #000;
            color: #fff;
            text-align: center;
            padding:15px;
        }
        .TOPContainer{
            height:100VH;
        } 
        .profile-card {
            width: 75%;
            background: rgba(255, 255, 255, 0.1);
            padding: 20px;
            border-radius: 15px;
            box-shadow: 0px 4px 10px rgba(255, 255, 255, 0.2);
            border:solid 1px;
            border-color:gray;
        }

        .profile-pic {
            width: 80px;
            height: 80px;
            border-radius: 50%;
            margin-bottom: 15px;
            border: 2px solid white;
        }

        .user-fullname {
            font-size: 20px;
            margin-bottom: 5px;
        }

        .bank-info, .contact-number, .join-date {
            font-size: 14px;
            opacity: 0.8;
            margin: 4px 0;
        }

        .greeting-text {
            font-size: 16px;
            font-weight: bold;
            margin: 10px 0;
        }

        .button-group {
            display: flex;
            justify-content: center;
            gap: 15px;
            margin: 15px 0;
        }

        .action-btn {
            padding: 10px 20px;
            border: none;
            border-radius: 20px;
            font-size: 16px;
            cursor: pointer;
            transition: 0.3s;
        }

        .pay-btn {
            background: #4a90e2;
            color: white;
            width:190px;
        }

        .back-btn {
            background: #31363b;
            color: white;
        }
        .main-back-btn {
            background: #31363b;
            color: white;
            margin-top:20px;
        }

        .action-btn:hover {
            opacity: 0.8;
        }

        .message-container {
            display: flex;
            justify-content: center;
            align-items: center;
            background: rgba(255, 255, 255, 0.2);
            border-radius: 20px;
            padding: 5px;
            margin-top: 10px;
            width: 60% !important;
            margin-left:20%;
        }

        .message-input {
            flex: 1;
            padding: 10px;
            border: none;
            border-radius: 20px;
            background: transparent;
            color: white;
            outline: none;
        }

        .send-btn {
            background: none;
            border: none;
            font-size: 18px;
            cursor: pointer;
            color: white;
            padding: 5px 10px;
        }
        .img-container{
            display:flex;
            justify-content:center;
            margin-top:10%;
        }
    .AppLogoImage {
    width: 30px;
    height: 30px;
    animation: rotateLogo 3s linear infinite;
    margin-top:10px;
    margin-right:10px;
}

@keyframes rotateLogo {
    from {
        transform: rotate(0deg);
    }
    to {
        transform: rotate(360deg);
    }
}
.flowpay-heading {
    font-family: 'Poppins', sans-serif; /* Modern & sleek font */
    font-size: 35px; /* Adjust size as needed */
    font-weight: 700; /* Bold and premium look */
    color: #ffffff; /* White text */
    text-transform: lowercase; /* Matches the 'FlowPay' style */
    letter-spacing: 1px;
    text-shadow: 2px 2px 4px rgba(0, 0, 0, 0.5); /* Soft shadow for depth */
}

.upi-button {
    font-family: 'Poppins', sans-serif;
    font-size: 8px;
    font-weight: 600;
    color: white;
    background: linear-gradient(145deg, #2a85ff, #1e5cc4); /* Gradient blue */
    border-radius:2px; /* Rounded button */
    height:35px;
    width:35px;
    box-shadow: 2px 2px 5px rgba(0, 0, 0, 0.3);
    text-align: center;
   margin-top:12px;
   margin-left:9px;
  
}
.tm{
    font-size:15px;
    padding-bottom:20px;
}


    </style>
</head>
<body>
    <div id="root"></div>

    <script type="text/babel">
        class UpiPhoneEntry extends React.Component {
            constructor(props) {
                super(props);
                this.state = {
                    AccountHolder:{},
                    isTransactionStarted:false,
                    phoneNumber: "",
                    ToUser: {
                        Name: "",
                        PhoneNumber: "",
                        BankID: "",
                        gotUser:false
                    },
                    triggerUser: false,
                    TransferAmount:0,
                    amountError:"",

                };
            
            }
            enterAmount = async (event)=>{
                await this.setState({TransferAmount:event.target.value})
            }
            

            addAmount = async () => {
               const isNumericExceptDot = (str) => {
                    return /^[0-9]+(\.[0-9]+)?$/.test(str);
                 };

               
                const {TransferAmount,ToUser,AccountHolder} = this.state 
                const AccHolder = AccountHolder
                
                const transactionCredentials = {
                    "TransferAmount":TransferAmount,
                    "ToUser":ToUser,
                    "FromUser":AccHolder
                }
                console.log(transactionCredentials)
                if(isNumericExceptDot(TransferAmount)){
                    console.log("String rules satisfied")
                    if(AccHolder["AccountBalance"]>=parseFloat(TransferAmount)){
                        console.log("Balance Rule Satisifies")
                        const Path = "/app/start/transaction"
                        const Options = {
                            method:"POST",
                            headers:{
                                "Content-Type":"application/json"
                            },
                            body:JSON.stringify(transactionCredentials)
                        }
                                
                                await fetch(Path,Options)
                                .then(res=>{
                                    if(res.ok){
                                        console.log("Transaction Started")
                                        return res.json()
                                    }
                                    else{
                                        throw new Error("Server Down")
                                    }
                                })
                                .then(data=>{
                                    console.log(data)
                                    window.location.href="/upi/transfer/enter/pin"
                                })
                                .catch(err=>{
                                    console.log("Errr:-\n  --> ",err)
                                })

                            }
                            else{
                                await this.setState({amountError:"Insufficient Account Balance"})
                            }
                        }
                        else{
                            await this.setState({amountError:"Enter Right Value"})
                        }
                    
                    }

                    
                    
                    
                    handleInputChange = async (event) => {
                        await this.setState({ phoneNumber: event.target.value });
                        const {phoneNumber} = this.state
                        if(phoneNumber===""){
                            this.setState({gotUser:false})
                        }
                        if(phoneNumber.length>=10){
                    const Path = "/get/Mobile/User"
                    const Options = {
                        method:"POST",
                        headers:{"Content-Type":"application/json"},
                        body:JSON.stringify({PhoneNumber:phoneNumber})
                    }
                    await fetch(Path,Options)
                    .then(res=>{
                        if(res.ok){
                            return res.json()
                        }
                        else{
                            throw new Error("No User")
                        }
                    })
                    .then(async (Data)=>{
                        console.log(Data)
                        if(Data.user !== null){
                                await this.setState({ToUser:Data.user,gotUser:true,AccountHolder:Data.AccountHolder})
                                console.log("==>got res==>",this.state)
                        }
                        else{
                        await this.setState({ToUser:{
                        Name:"!",
                        PhoneNumber:"Ivalid Number",
                        BankID:"No UPI User"
                        }})
               }

            })
            .catch(err=>{
                console.log("ERR:\n   --->  ",err)
            })
        }
            };
            startTransaction = () => {
                this.setState({triggerUser:true})

            }
            goBack = () =>{
                window.location.href="/user/application/open/"
            }

            render() {
                const { triggerUser, phoneNumber, ToUser,gotUser } = this.state;
                const {Name,PhoneNumber,BankID,BankingName} = ToUser
                console.log(this.state)
                if (!triggerUser) {
                    return (

                    <div>
                        <div style={{padding:"20px",display:"flex","justify-content":"center","background":"linear-gradient(to bottom right, #121212, #292929)"}}>
                            <img className="AppLogoImage" src="https://lh6.ggpht.com/w8lmlhtTuVcmEEMpeH86ysnffrSD7rmtYR0qCSlLkn94khLN0O54yKT3GesX4A8WMnU%3Dw300" alt="App"/>
                            <h1 className="flowpay-heading">FlowPay<span className="tm">™</span></h1>
                            <button className="upi-button">UPI</button>
                    </div>
                        <div className="Body">
                        <div className="container">
                            <div className="header">Enter a phone number</div>
                            <input 
                                type="tel" 
                                placeholder="Enter phone number" 
                                className="input-box"
                                value={phoneNumber}
                                onChange={this.handleInputChange}
                            />
                        <button  className="btn">Sync Contacts</button>
                            
                           {gotUser&&(<div onClick={this.startTransaction} className="ToUserContainer">
                                    
                                <div className="w-10 h-10 flex items-center justify-center bg-gray-600 rounded-full text-white text-lg font-semibold">
                                {Name[0]}
                            </div>
                            <div className="ml-3">
                                <p className="text-white">{Name}</p>
                                <p className="text-gray-400 text-sm">{PhoneNumber}</p>
                                
                            </div>
                            </div>)
                        } 
                        <button onClick={this.goBack} class="action-btn main-back-btn">Back</button>
                        </div>
                        </div>
                        </div>
                    );
                }

                return (
            
<div className="TOPContainer" style={{background:"black"}}>
    
                        <div style={{padding:"20px",display:"flex","justify-content":"center","background":"linear-gradient(to bottom right, #121212, #292929)"}}>
                            <img className="AppLogoImage" src="https://lh6.ggpht.com/w8lmlhtTuVcmEEMpeH86ysnffrSD7rmtYR0qCSlLkn94khLN0O54yKT3GesX4A8WMnU%3Dw300" alt="App"/>
                            <h1 className="flowpay-heading">FlowPay<span className="tm">™</span></h1>
                            <button className="upi-button">UPI</button>
                        </div>
                    <div class="page-container">
                        <div class="profile-card">
                            <div className="img-container">
                                <img class="profile-pic" src="" alt="Profile"/>
                            </div>
                            <h2 class="user-fullname">{Name}</h2>
                            <p class="bank-info">Banking name: <strong>{BankingName}</strong></p>
                            <p class="contact-number">{PhoneNumber}</p>
                            <p class="join-date">Joined March 2025</p>
                            <p class="greeting-text">Easy “Pay..! 👋”</p>
                            <div class="button-group">
                                    <button onClick={this.addAmount} class="action-bn pay-btn">Pay</button>
                                    <button onClick={()=>{this.setState({triggerUser:false})}} class="action-btn back-btn">Back</button>
                            </div>
                            <div class="message-container">
                                    <input type="text" class="message-input" placeholder="Message..." onChange={this.enterAmount}/>
                                    <button class="send-btn">➤</button>
                            </div>
                        </div>
                    </div>
</div>                

                );
            
            
            
            }
        }
        ReactDOM.createRoot(document.getElementById("root")).render(<UpiPhoneEntry />);
    </script>
</body>
</html>
